# Subscription aggregator

REST API для агрегации данных об онлайн-подписках пользователей.

## Предварительная настройка (перед запуском)

Склонировать репозиторий и перейти в папку с репозиторием

```shell
git clone https://github.com/ej-you/SubscriptionAggregator.git
cd ./SubscriptionAggregator
```

В корне проекта необходимо создать файл .env и поместить в него переменные окружения:

```dotenv
POSTGRES_USER="aggregator"
POSTGRES_PASSWORD="p@SSw0rd"
POSTGRES_DB="aggregator_db"
PGDATA="/var/lib/postgresql/data/pgdata"

POSTGRES_HOST="postgresql"
POSTGRES_PORT="5432"
```

## Запуск

```shell
docker compose -f ./docker-compose.yml up -d
```

> !! Затем необходимо провести миграции, используя команду !!
>
> ```shell
> docker compose -f ./docker-compose.yml exec server sh -c "/app/migrator up"
> ```

По умолчанию сервер запускается на `8000` порту.

Swagger документация — `/api/v1/docs`.

[Ссылка](http://127.0.0.1:8000/api/v1/docs) на swagger документацию (локальный адрес).

Чтобы остановить сервер используйте

```shell
docker compose -f ./docker-compose.yml down
```

## Дополнительно

### Работа ресурса для получения суммы

Этот ресурс работает с необязательными `query-параметрами`.
Особенности выборки по датам начала/конца:

1. Указана только дата начала - будут выбраны записи с датой начала, которая раньше данной, и отсутствующей датой конца.
2. Указана только дата конца - будут выбраны записи с датой конца на месяц больше данной.
3. Указаны обе даты - будут выбраны записи по критериям выше, а также:
    - с вхождением даты начала в полуинтервал `[start:end)`
    - с вхождением интервала дат записи в интервал данных дат
    - с вхождением даты конца в полуинтервал `(start:end]`

> *Все условия __для дат__ объединены через логическое `ИЛИ`
